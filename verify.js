const {OAuth2Client} = require('google-auth-library');
const credentials = require('./credentials.json');
const client_id = credentials.web.client_id;
const client = new OAuth2Client(client_id);

const verify = async (token) => {
    const ticket = await client.verifyIdToken({
        idToken: token,
        audience: client_id
    });
    const payload = ticket.getPayload();
    const userid = payload['sub'];
    //console.log(payload)
    //console.log(userid)
    //console.log(parseInt(userid, 10))
    return userid;
}

//verify("eyJhbGciOiJSUzI1NiIsImtpZCI6IjI3YzcyNjE5ZDA5MzVhMjkwYzQxYzNmMDEwMTY3MTM4Njg1ZjdlNTMiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiI2NzY2NTkzMjQ5MDYtdG85bTkyanQxZzg2NHVvcmJlZmk1NGIxdThlZnN1cWkuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJhdWQiOiI2NzY2NTkzMjQ5MDYtdG85bTkyanQxZzg2NHVvcmJlZmk1NGIxdThlZnN1cWkuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMDYzMDY0Njg0OTgxMzIwMjE3MDkiLCJhdF9oYXNoIjoieFFRVm1nVEpxZzFvNjlieVhlalNTZyIsIm5hbWUiOiJBYXJvbiBIYXJyaXMiLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2EvQUFUWEFKekRJRjVBc3JpZUlERHFKcUZCWVN3NDJ5OFVWV3h2WjBJQnZYWTQ9czk2LWMiLCJnaXZlbl9uYW1lIjoiQWFyb24iLCJmYW1pbHlfbmFtZSI6IkhhcnJpcyIsImxvY2FsZSI6ImVuIiwiaWF0IjoxNjM2OTYwMDUyLCJleHAiOjE2MzY5NjM2NTJ9.a55hDh9reui8WcxhAz0CncHXZmBBmXQpzmJ4rGFRq0bIJ-KgmOiRh8nEGNcEuFV39uUHcD6ZBntqSvf9JfLh3R_ksXZgAKzxoqVRZ6VONY7VOm7qN07TFFKnvP1khVltDWOmQa3W8EAHfG9OEWQRG4BaMKNO6gDoT-FRK755vzZ93V1eqauSjmZhdGJxc6fkPboC4pvGLJ4LHkhI9H3e13AqjgimV39AVe8Vz6dNGl9Blzi-BQ31S6vBpCNYm5cdUNukg52Jap8oXV-z-CaHpmXmBFsGNkpF9D_c_YdvpTylszKd0kAiZdw58YKm-d9VKytCy30e-1Pb-1xWXh5a_Q").catch(console.error);
//erify("eyJhbGciOiJSUzI1NiIsImtpZCI6ImQ0ZTA2Y2ViMjJiMDFiZTU2YzIxM2M5ODU0MGFiNTYzYmZmNWE1OGMiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiIyNTAzMzg5OTg5OTktMGVxbHJ1dmk0MDgxOTdtdDdvbW5sc2tkM2ZoNW01cnMuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJhdWQiOiIyNTAzMzg5OTg5OTktMGVxbHJ1dmk0MDgxOTdtdDdvbW5sc2tkM2ZoNW01cnMuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMDYzMDY0Njg0OTgxMzIwMjE3MDkiLCJhdF9oYXNoIjoieUxNSGJ5am1laElTMHRfSjg1RjViQSIsIm5hbWUiOiJBYXJvbiBIYXJyaXMiLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2EvQUFUWEFKekRJRjVBc3JpZUlERHFKcUZCWVN3NDJ5OFVWV3h2WjBJQnZYWTQ9czk2LWMiLCJnaXZlbl9uYW1lIjoiQWFyb24iLCJmYW1pbHlfbmFtZSI6IkhhcnJpcyIsImxvY2FsZSI6ImVuIiwiaWF0IjoxNjM3ODQwNTU4LCJleHAiOjE2Mzc4NDQxNTh9.D8sFCrgLSRQl1lUF7qyZoT1cGd2BvUUGH1QG6IisQ3hIW9VNb5BpekL3SbTL_Tv9mtLFqDVUgtdal-UXvYzSYNEyV-2tr2Pq1Z-FgUpMT5KOq-NNPropewuE48ChJjao3vey9BjeTH_KS4qJ-NE0d2_eofyGqre3uGNg15On3cF8f_LjYGQJPUAaHy6PdajTcNwtA5VBt4DLVuOw2MMSBoPFmB6ji135N_FXX_PQo37Dlx3NwVeUQi6yeXMWszW8jQzSqySGCoTtg6RogBC9TdHMmb1z6B_UAFfe5whAj2JcVd5XOBvYf1bqKV5ktUnLhTo3ts7PqZt5Ou5P4_L1Ew").catch(console.error)

module.exports = {
    verify
};